name: Build

on: [pull_request, push]

jobs:
  build-on-ubuntu:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: install build dependencies
        run: sudo apt install -y build-essential cmake zlib1g-dev
      - name: cmake
        run: cmake -DUSE_CLANG_TIDY=1 .
      - name: make
        run: make -j`nproc`
  build-on-macos:
    runs-on: macos-latest
    steps:
       - uses: actions/checkout@v2
       - name: install build dependencies
         run: |
           brew install llvm
           ln -s "/usr/local/opt/llvm/bin/clang-tidy" "/usr/local/bin/clang-tidy"
           brew install cmake zlib
       - name: cmake
         run: cmake -DUSE_CLANG_TIDY=1 .
       - name: make
         run: make -j`nproc`
  build-on-windows:
    runs-on: windows-2019
    steps:
      - uses: actions/checkout@v2
      - uses: lukka/get-cmake@latest
      - name: Restore artifacts, or setup vcpkg (do not install any package)
        uses: lukka/run-vcpkg@v10
        with:
          vcpkgGitCommitId: '5ddd7f02689b7c5aab78711d77f61db5d2e5e79c'
      - name: Run CMake consuming CMakePreset.json and vcpkg.json by mean of vcpkg.
        uses: lukka/run-cmake@v10
        with:
          configurePreset: 'msbuild-vcpkg'
          buildPreset: 'msbuild-vcpkg'
